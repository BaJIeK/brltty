Name: @PACKAGE_NAME@
Version: @PACKAGE_VERSION@
Release: 1

Group: System Environment/Daemons
Copyright: GPL
Vendor: The BRLTTY Team
Packager: Dave Mielke <dave@mielke.cc>
URL: http://mielke.cc/brltty/
Source: http://mielke.cc/brltty/releases/%{name}-%{version}.tar.gz

BuildRoot: %{_tmppath}/%{name}-%{version}-InstallRoot

AutoProv: 0

AutoReq: 0
Requires: ld-linux.so.2
Requires: libc.so.6
Requires: libdl.so.2
Requires: libm.so.6
Requires: /bin/sh

Summary: Braille display driver for Linux/Unix.
%description
BRLTTY is a background process (daemon) which provides
access to the Linux/Unix console (when in text mode)
for a blind person using a refreshable braille display.
It drives the braille display,
and provides complete screen review functionality.
Some speech capability has also been incorporated.

%prep
%setup -n %{name}-%{version}

%build
set -e

./configure --with-install-root="${RPM_BUILD_ROOT}" --enable-api
make

directory="doc"
mkdir -p "${directory}"
for file in `find . -path "./${directory}" -prune -o \( -name 'README*' -o -name '*.txt' -o -name '*.html' -o -name '*.sgml' -o \( -path "./Bootdisks/*" -type f -perm +ugo=x \) \) -print`
do
   mkdir -p "${directory}/${file%/*}"
   cp -rp "${file}" "${directory}/${file}"
done
unset file directory

%install
set -e

make install
install Documents/brltty.conf "${RPM_BUILD_ROOT}/etc"

%files
%defattr(-,root,root)
%doc COPYING
%doc Documents/ChangeLog Documents/TODO
%doc doc/*
%config(noreplace) /etc/brltty.conf
/bin/brltty
/bin/brltty-*
/etc/brltty
/lib/brltty
/usr/lib/libbrlapi.*
/usr/include/brltty
/usr/share/man/man?/*

%pre
rm -f "@configuration_directory@/@configuration_file@.rpmnew"

%post
file="@configuration_directory@/@configuration_file@"
new="${file}.rpmnew"
[ -f "${new}" ] && file="${new}"
(  set -- -u -f "${file}"
   @configuration_file_customization_script@
)

