ANDROID_PACKAGE_NAME = BRLTTY
ANDROID_PACKAGE_FILE = bin/$(ANDROID_PACKAGE_NAME)-debug.apk
ANDROID_PACKAGE_PATH = org.a11y.BRLTTY.Android

ANDROID_LOCAL_FILES = local.properties
ANDROID_ASSETS_DIRECTORY = assets
ANDROID_TABLES_DIRECTORY = $(ANDROID_ASSETS_DIRECTORY)/tables

ANDROID_LIBRARIES_DIRECTORY = libs/armeabi
ANDROID_CORE_LIBRARY = $(LIB_PFX)$(PACKAGE_NAME)_core.$(LIB_EXT)
ANDROID_JNI_LIBRARY = $(LIB_PFX)$(PACKAGE_NAME)_jni.$(LIB_EXT)

all: $(ANDROID_LOCAL_FILES) tables libraries
	ant debug

$(ANDROID_LOCAL_FILES):
	android update project --path .

tables:
	$(INSTALL_DIRECTORY) $(ANDROID_TABLES_DIRECTORY)
	$(INSTALL_DATA) $(SRC_TOP)$(TBL_DIR)/*.[tack]t[bi] $(ANDROID_TABLES_DIRECTORY)

libraries:
	cd $(BLD_TOP)$(PGM_DIR) && $(MAKE) $(ANDROID_CORE_LIBRARY) $(ANDROID_JNI_LIBRARY)
	$(INSTALL_DIRECTORY) $(ANDROID_LIBRARIES_DIRECTORY)
	$(INSTALL_SCRIPT) $(BLD_TOP)$(PGM_DIR)/$(ANDROID_CORE_LIBRARY) $(ANDROID_LIBRARIES_DIRECTORY)
	$(INSTALL_SCRIPT) $(BLD_TOP)$(PGM_DIR)/$(ANDROID_JNI_LIBRARY) $(ANDROID_LIBRARIES_DIRECTORY)
	$(STRIP) $(ANDROID_LIBRARIES_DIRECTORY)/*.$(LIB_EXT)

clean::
	-rm -f $(ANDROID_LOCAL_FILES)
	-rm -f -r $(ANDROID_ASSETS_DIRECTORY)
	-rm -f -r gen
	-rm -f -r bin/*
	-rm -f -r libs/*

install: all
	adb install $(ANDROID_PACKAGE_FILE)

uninstall:
	adb uninstall $(ANDROID_PACKAGE_PATH)

