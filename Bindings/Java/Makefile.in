###############################################################################
# libbrlapi - A library providing access to braille terminals for applications.
#
# Copyright (C) 2006-2008 by
#   Samuel Thibault <Samuel.Thibault@ens-lyon.org>
#   SÃ©bastien Hinderer <Sebastien.Hinderer@ens-lyon.org>
#
# libbrlapi comes with ABSOLUTELY NO WARRANTY.
#
# This is free software, placed under the terms of the
# GNU Lesser General Public License, as published by the Free Software
# Foundation; either version 2.1 of the License,
# or (at your option) any later version.
# Please see the file COPYING-API for details.
#
# Web Page: http://mielke.cc/brltty/
#
# This software is maintained by Dave Mielke <dave@mielke.cc>.
###############################################################################

include $(SRC_TOP)bindings.mk

JAVA_OK = @JAVA_OK@
JAVAC = @JAVAC@
JAVADOC = @JAVADOC@
JAR = @JAR@

JAVA_JAR = @JAVA_JAR@
JAVA_JAR_DIR = @JAVA_JAR_DIR@

JAVA_JNI = @JAVA_JNI@
JAVA_JNI_DIR = @JAVA_JNI_DIR@
JAVA_JNI_HDR = @JAVA_JNI_HDR@
JAVA_JNI_INC = @JAVA_JNI_INC@
JAVA_JNI_FLAGS = @JAVA_JNI_FLAGS@

all: jar jni doc

JAVA_JNI_FILE = $(LIB_PFX)$(API_NAME)_java.$(LIB_EXT)
jni: $(JAVA_JNI_FILE)

$(JAVA_JNI_FILE): bindings.$O $(API_NAME)
	$(MKLIB:<name>=$(API_NAME)) $@ bindings.$O $(API_LDFLAGS)

bindings.$O:
	$(CC) $(LIBCFLAGS) $(JAVA_JNI_FLAGS) -o $@ -c $(SRC_DIR)/bindings.c

JAVA_JAR_FILE = $(API_NAME).jar
jar: $(JAVA_JAR_FILE)

API_CLASSES = Brlapi.class BrlapiNative.class BrlapiError.class BrlapiException.class BrlapiSettings.class BrlapiWriteArguments.class BrlapiSize.class BrlapiKey.class
ALL_CLASSES = $(API_CLASSES) ApiTest.class

$(JAVA_JAR_FILE): $(API_CLASSES)
	$(JAR) cf $@ Brlapi*.class

$(ALL_CLASSES): $(SRC_DIR)/*.java BrlapiConstants.class
	$(JAVAC) -d . -classpath . $(SRC_DIR)/*.java

BrlapiConstants.class: BrlapiConstants.java
	$(JAVAC) BrlapiConstants.java

BrlapiConstants.java: $(CONSTANTS_SCRIPTS) $(CONSTANTS_SOURCES)
	$(AWK) $(CONSTANTS_OPTIONS) $(CONSTANTS_SOURCES) >$@

doc: javadoc.made

javadoc.made: $(SRC_DIR)/*.java BrlapiConstants.java
	$(JAVADOC) -quiet -d . -author -version -use $(SRC_DIR)/*.java BrlapiConstants.java
	touch $@

clean::
	-rm -f BrlapiConstants.java *.class $(JAVA_JAR_FILE) $(JAVA_JNI_FILE)
	-rm -f javadoc.made package-list *.css *.html
	-rm -f -r resources
	-rm -f gjdoc.properties JAVADOC.PLACEHOLDER

install: install-jar install-jni

install-jar: install-jar-$(JAVA_JAR)

install-jar-yes: jar
	$(INSTALL_DIRECTORY) $(INSTALL_ROOT)$(JAVA_JAR_DIR)
	$(INSTALL) $(JAVA_JAR_FILE) $(INSTALL_ROOT)$(JAVA_JAR_DIR)

install-jar-no:
	@echo jar not installed

install-jni: install-jni-$(JAVA_JNI)

install-jni-yes: jni
	$(INSTALL_DIRECTORY) $(INSTALL_ROOT)$(JAVA_JNI_DIR)
	$(INSTALL) $(JAVA_JNI_FILE) $(INSTALL_ROOT)$(JAVA_JNI_DIR)

install-jni-no:
	@echo jni not installed

uninstall: uninstall-jar uninstall-jni

uninstall-jar: uninstall-jar-$(JAVA_JAR)

uninstall-jar-yes:
	-rm -f -- $(INSTALL_ROOT)$(JAVA_JAR_DIR)/$(JAVA_JAR_FILE)

uninstall-jar-no:

uninstall-jni: uninstall-jni-$(JAVA_JNI)

uninstall-jni-yes:
	-rm -f -- $(INSTALL_ROOT)$(JAVA_JNI_DIR)/$(JAVA_JNI_FILE)

uninstall-jni-no:

