###############################################################################
# BRLTTY - A background process providing access to the console screen (when in
#          text mode) for a blind person using a refreshable braille display.
#
# Copyright (C) 1995-2006 by The BRLTTY Developers.
#
# BRLTTY comes with ABSOLUTELY NO WARRANTY.
#
# This is free software, placed under the terms of the
# GNU General Public License, as published by the Free Software
# Foundation.  Please see the file COPYING for details.
#
# Web Page: http://mielke.cc/brltty/
#
# This software is maintained by Dave Mielke <dave@mielke.cc>.
###############################################################################

include $(SRC_TOP)bindings.mk

PYREXC = @PYREXC@
PYTHON_CPPFLAGS = @PYTHON_CPPFLAGS@
PYTHON_LDFLAGS = @PYTHON_LDFLAGS@
PYTHON_SITE_PKG = @PYTHON_SITE_PKG@

PYTHON_API = brlapi.$(LIB_EXT)

all: $(PYTHON_API)

$(PYTHON_API): brlapi.$O api
	$(MKLIB:<name>=brlapi) $@ brlapi.$O $(PYTHON_LDFLAGS) $(API_LDFLAGS)

brlapi.$O: brlapi.auto.c $(API_HEADERS)
	$(CC) $(LIBCFLAGS) $(PYREXC_CFLAGS) $(PYTHON_CPPFLAGS) -o $@ -c brlapi.auto.c

brlapi.auto.c: $(SRC_DIR)/brlapi.pyx $(SRC_DIR)/c_brlapi.pxd cmddefs.auto.pyx
	$(PYREXC) -o $@ $(SRC_DIR)/brlapi.pyx

cmddefs.auto.pyx: $(API_HEADER) $(APIDEFS_AWK) $(BRLDEFS_HDR) $(BRLDEFS_AWK) $(SRC_DIR)/cmddefs.awk
	$(AWK) -f $(APIDEFS_AWK) -f $(BRLDEFS_AWK) -f $(SRC_DIR)/cmddefs.awk $(API_HEADER) $(BRLDEFS_HDR) >$@

install: all
	$(INSTALL_DIRECTORY) $(INSTALL_ROOT)$(PYTHON_SITE_PKG)
	$(INSTALL_PROGRAM) $(PYTHON_API) $(INSTALL_ROOT)$(PYTHON_SITE_PKG)

uninstall: $(PYTHON_API)
	-rm -f $(INSTALL_ROOT)$(PYTHON_SITE_PKG)/$(PYTHON_API)

clean::
	-rm -f $(PYTHON_API) *.auto.pyx

